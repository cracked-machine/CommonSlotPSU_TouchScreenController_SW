/*
 * TSC2046_STM32_InterruptManager.c
 *
 *  Created on: Jul 4, 2020
 *      Author: chris
 */

#include "TSC2046_STM32_InterruptManager.h"
#include "TSC2046_STM32_EventManger.h"
#include "TSC2046_STM32_HardwareManager.h"

#include <stdint.h>

uint32_t touchscreen_last_interrupt_time = 0;
#define MAX_TOUCHSCREEN_DEBOUNCE_DELAY 500

/*
 *
 *	@brief 	Interrupt handler for TSC2046 PENIRQ
 *			Call this from stm32fxxx_it.c EXTI function
 *
 *	@param None
 *	@retval
 *
 */
void TSC2046_IM_PENIRQ_EXTI_Handler()
{
//	uint32_t interrupt_time = TSC2046_HW_DEBOUNCE_TIMER->CNT;

//	if( (interrupt_time - touchscreen_last_interrupt_time) > MAX_TOUCHSCREEN_DEBOUNCE_DELAY )
//	{

	TSC2046_EventsTypedef test = TSC2046_evPen;
	TSC2046_EM_ProcessEvent(&test);
//	}
//	touchscreen_last_interrupt_time = interrupt_time;
}

/*
 *
 *	@brief	Timer Interrupt handler for HardwareManager
 *			Call this from stm32fxxx_it.c Timer function
 *
 *	@param None
 *	@retval
 *
 */
void TSC2046_IM_HardwareManagerLoopHandler()
{
	if(HAL_GPIO_ReadPin(TS_IRQ_GPIO_Port, TS_IRQ_Pin) == 0)
	{
		TSC2046_EM_ProcessEvent(&TSC2046_evPen);
	}
	else
	{
		TSC2046_EM_ProcessEvent(&TSC2046_evIdle);
	}
}
